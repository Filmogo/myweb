<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <title>‚úàÔ∏è Crash Mini ‚Äî Demo</title>
  <meta name="theme-color" content="#0b1226" />
  <style>
    :root{ --vh:1vh; --bg:#0b1226; --bg2:#0f1f4a; --text:#e8f0ff; --muted:#a9b8ff; --ok:#72ffa6; --bad:#ff6a89; --warn:#ffd36a; }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      height: calc(var(--vh) * 100); /* —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö */
      overflow: hidden;
      background:
        radial-gradient(1200px 800px at 15% 10%, var(--bg2), transparent),
        radial-gradient(900px 700px at 80% 90%, #102054, transparent),
        linear-gradient(180deg, var(--bg), var(--bg));
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Noto Sans", Arial;
      display: flex; align-items: center; justify-content: center;
    }

    .app{
      width: min(980px, 100%);
      height: 100%;
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 10px;
      padding: 14px;
    }

    .top{
      display: flex; align-items: center; justify-content: space-between;
      gap: 10px;
    }
    .brand{ font-weight: 900; letter-spacing:.3px; display:flex; align-items:center; gap:10px; }
    .pill{ font-size:12px; padding:6px 10px; border-radius:999px; background:#0a1a38; color:var(--muted); border:1px solid #1a2a56; }
    .balance{ background:#0a1a38; border:1px solid #1a2a56; padding:8px 12px; border-radius:12px; display:flex; gap:8px; align-items:center; }
    .balance b{ font-size:18px; }

    .board{
      position: relative;
      border:1px solid #1a2a56; border-radius:18px;
      background: linear-gradient(180deg, rgba(20,36,80,.5), rgba(10,18,40,.5));
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 40px rgba(114,255,210,.08);
      overflow: hidden;
      display: grid; grid-template-rows: auto 1fr;
    }
    .hud{
      display:flex; align-items:center; justify-content:space-between; padding:10px 12px; gap:10px; border-bottom:1px solid #1a2a56;
    }
    .hud .mult{ font-weight:800; font-size: clamp(22px, 6vw, 34px); }
    .hud .status{ font-size:13px; color:var(--muted); }
    .area{ position: relative; }

    /* —Å–∞–º–æ–ª—ë—Ç–∏–∫ –∏ —Ç—Ä–µ–∫ */
    .plane{ position:absolute; left: 10%; bottom: 14%; transform: translate(-50%, 50%); font-size: clamp(24px, 8vw, 40px); }
    .trail{ position:absolute; left:0; bottom:0; width:2px; background:linear-gradient(180deg, #72ffd2, transparent); opacity:.85 }

    /* –ø–∞–Ω–µ–ª—å —Å—Ç–∞–≤–æ–∫ */
    .panel{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      border:1px solid #1a2a56; border-radius:14px; background:#0a1a38; padding:10px;
    }
    .field{
      display:flex; align-items:center; gap:8px; background:#0b1b3d; border:1px solid #1a2a56; padding:8px 10px; border-radius:10px;
    }
    .field input{
      width:110px; background:transparent; border:none; outline:none; color:#fff; font-size:16px;
    }
    .btn{
      padding:10px 14px; border:none; border-radius:12px; font-weight:800; cursor:pointer;
      box-shadow: 0 8px 18px rgba(0,0,0,.25);
    }
    .primary{ background:linear-gradient(180deg,#6aa3ff,#4b87ff); color:#05122c; }
    .danger{ background:linear-gradient(180deg,#ff869e,#ff6a89); color:#2b0511; }
    .ghost{ background:transparent; border:1px solid #1a2a56; color:var(--muted); }

    .log{ font-size:13px; color:var(--muted); max-height: 86px; overflow:auto; padding-right:6px; }
    .log b.win{ color: var(--ok) } .log b.lose{ color: var(--bad) }

    .toast{
      position: fixed; left: 50%; bottom: 22px; transform: translateX(-50%) translateY(20px);
      background:#0b1a3a; border:1px solid #1a2a56; padding:10px 14px; border-radius:12px;
      opacity:0; transition: opacity .2s, transform .2s; pointer-events:none;
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(0) }
  </style>
</head>
<body>
  <div class="app">
    <!-- –®–ê–ü–ö–ê -->
    <div class="top">
      <div class="brand">‚úàÔ∏è <span>Crash Mini</span> <span class="pill">–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã</span></div>
      <div class="balance">–ë–∞–ª–∞–Ω—Å: <b id="balance">1 000</b> üí∞</div>
    </div>

    <!-- –ò–ì–†–û–í–û–ï –ü–û–õ–ï -->
    <div class="board" id="board">
      <div class="hud">
        <div>
          <div class="status" id="status">–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏‚Ä¶</div>
          <div class="status">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫—Ä–∞—à–∞ —Å–∫—Ä—ã—Ç</div>
        </div>
        <div class="mult" id="mult">x1.00</div>
      </div>
      <div class="area" id="area">
        <div class="plane" id="plane">üõ©Ô∏è</div>
        <!-- —Ö–≤–æ—Å—Ç –±—É–¥–µ—Ç —Ä–∏—Å–æ–≤–∞—Ç—å—Å—è JS —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ .trail -->
      </div>
    </div>

    <!-- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
    <div class="panel">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
        <div class="field">
          <span>–°—Ç–∞–≤–∫–∞ üí∞</span>
          <input id="bet" type="number" min="1" step="1" value="10" />
          <button class="ghost" id="bet25">+25</button>
          <button class="ghost" id="bet100">+100</button>
          <button class="ghost" id="betMax">MAX</button>
        </div>
        <div class="field">
          <span>–ê–≤—Ç–æ-–∫—ç—à–∞—É—Ç</span>
          <input id="autoCash" type="number" min="1.01" step="0.01" value="‚Äî" placeholder="‚Äî" />
        </div>
      </div>

      <div style="display:flex; gap:10px">
        <button class="btn primary" id="startBtn">–°–¢–ê–í–ö–ê / –°–¢–ê–†–¢</button>
        <button class="btn danger" id="cashBtn" disabled>–ó–ê–ë–†–ê–¢–¨</button>
      </div>
    </div>

    <div class="log" id="log"></div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ======= –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –∏ —Ñ–∏–∫—Å 100vh =======
    function setVH(){ document.documentElement.style.setProperty('--vh', (window.innerHeight*0.01) + 'px'); }
    setVH(); addEventListener('resize', setVH); addEventListener('orientationchange', setVH); setTimeout(setVH, 50);

    function tgExpand(){
      try{
        if(window.Telegram?.WebApp){
          Telegram.WebApp.ready?.(); Telegram.WebApp.expand?.(); Telegram.WebApp.disableVerticalSwipes?.();
          Telegram.WebApp.setHeaderColor?.('secondary_bg_color'); Telegram.WebApp.setBackgroundColor?.('#0b1226');
        }
      }catch(e){}
    }
    tgExpand(); document.addEventListener('DOMContentLoaded', tgExpand);

    // –ù–∞—Ç–∏–≤–Ω—ã–π fullscreen –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ –ø–µ—Ä–≤–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é
    let fsTried=false;
    function tryFS(){ if(fsTried) return; fsTried=true;
      const el=document.documentElement;
      if(el.requestFullscreen) el.requestFullscreen().catch(()=>{});
      else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    }
    document.addEventListener('click', tryFS, { once:true, capture:true });
    document.addEventListener('touchend', tryFS, { once:true, capture:true });

    // ======= –õ–û–ì–ò–ö–ê –ò–ì–†–´ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã, –ú–û–®–ù–´–ô –ë–ê–ô–ê–° –í –ü–†–û–ò–ì–†–´–®) =======
    const elBalance = document.getElementById('balance');
    const elBet = document.getElementById('bet');
    const elAutoCash = document.getElementById('autoCash');
    const elStart = document.getElementById('startBtn');
    const elCash = document.getElementById('cashBtn');
    const elMult = document.getElementById('mult');
    const elStatus = document.getElementById('status');
    const elArea = document.getElementById('area');
    const elPlane = document.getElementById('plane');
    const elLog = document.getElementById('log');
    const elToast = document.getElementById('toast');

    // –±–∞–ª–∞–Ω—Å—ã –≤ localStorage (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ)
    let balance = +(localStorage.getItem('crash-balance') || 1000);
    updateBalance();

    // –ö–Ω–æ–ø–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏
    document.getElementById('bet25').onclick = ()=> addBet(25);
    document.getElementById('bet100').onclick = ()=> addBet(100);
    document.getElementById('betMax').onclick = ()=>{
      elBet.value = Math.max(1, Math.floor(balance));
    };

    function addBet(n){
      const v = Math.max(0, +elBet.value||0) + n;
      elBet.value = v;
    }
    function updateBalance(){
      elBalance.textContent = balance.toLocaleString('ru-RU');
      localStorage.setItem('crash-balance', balance);
    }
    function toast(msg, ms=1200){
      elToast.textContent = msg; elToast.classList.add('show');
      clearTimeout(toast._t); toast._t = setTimeout(()=> elToast.classList.remove('show'), ms);
    }
    function logLine(html){
      const div = document.createElement('div'); div.innerHTML = html;
      elLog.prepend(div);
      // –æ–≥—Ä–∞–Ω–∏—á–∏–º —Ä–∞–∑–º–µ—Ä –ª–æ–≥–∞
      while(elLog.children.length > 50) elLog.removeChild(elLog.lastChild);
    }

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—É–Ω–¥–∞
    let running = false;
    let crashed = false;
    let t0 = 0;
    let raf = null;
    let crashAt = 1.0; // –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –∫—Ä–∞—à
    let currentMult = 1.0;
    let betPlaced = 0;
    let cashoutPaid = false;

    // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä "–æ—á–µ–Ω—å –∑–ª–æ–≥–æ" —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è ‚Äî —à–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π.
    // –ò–¥–µ—è: 35% ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π/—Ä–∞–Ω–Ω–∏–π –∫—Ä–∞—à [1.00..1.05]; 50% ‚Äî —Ä–∞–Ω–Ω–∏–π –∫—Ä–∞—à [1.00..1.40] –ø–æ –∫—É–±–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π; 15% ‚Äî —Å—Ä–µ–¥–Ω–∏–π [1.4..3.0].
    function drawCrashMultiplier(){
      const r = Math.random();
      if (r < 0.35) {
        // —Å–æ–≤—Å–µ–º —Ä–∞–Ω–Ω–∏–π
        return +(1.00 + Math.random()*0.05).toFixed(2);
      } else if (r < 0.85) {
        // –∫—Ä–∏–≤–∞—è —Å —Å–∏–ª—å–Ω—ã–º –ø–µ—Ä–µ–∫–æ—Å–æ–º –∫ –Ω–∏–∑—É
        const u = Math.random() ** 3; // –º–Ω–æ–≥–æ –Ω–∏–∑–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        return +(1.01 + u * 0.39).toFixed(2); // [1.01..1.40]
      } else {
        // —Ä–µ–¥–∫–∞—è —É–¥–∞—á–∞
        const u = Math.random() ** 2; // –≤—Å—ë –µ—â—ë —Å–º–µ—â–µ–Ω–æ –≤–Ω–∏–∑
        return +(1.4 + u * 1.6).toFixed(2); // [1.4..3.0]
      }
    }

    // –ü—Ä–æ—Ñ–∏–ª—å —Ä–æ—Å—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ (–ø–ª–∞–≤–Ω—ã–π —Ä–æ—Å—Ç, —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º)
    function multAt(timeSec){
      // —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç —Å –º—è–≥–∫–∏–º —Å—Ç–∞—Ä—Ç–æ–º
      const k = 0.55; // —Å–∫–æ—Ä–æ—Å—Ç—å
      const m = Math.max(1.0, Math.exp(k * timeSec) / Math.E + 1); // ~ –æ—Ç 1.0 –≤–≤–µ—Ä—Ö
      return m;
    }

    function resetRoundVisual(){
      // —Å–±—Ä–æ—Å —Å–∞–º–æ–ª—ë—Ç–∞ –∏ —Ö–≤–æ—Å—Ç–æ–≤
      currentMult = 1.0;
      elMult.textContent = 'x1.00';
      elStatus.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏‚Ä¶';
      crashed = false; cashoutPaid = false; betPlaced = 0;
      // –æ—á–∏—Å—Ç–∫–∞ —Ö–≤–æ—Å—Ç–∞
      [...elArea.querySelectorAll('.trail')].forEach(n=>n.remove());
      // –≤–µ—Ä–Ω—É—Ç—å —Å–∞–º–æ–ª—ë—Ç –≤–Ω–∏–∑/–≤–ª–µ–≤–æ
      elPlane.style.left = '10%';
      elPlane.style.bottom = '14%';
      elPlane.textContent = 'üõ©Ô∏è';
      elCash.disabled = true;
      elStart.disabled = false;
    }

    function startRound(){
      if (running) return;
      const bet = Math.floor(+elBet.value || 0);
      if (bet <= 0) { toast('–£–∫–∞–∂–∏ —Å—Ç–∞–≤–∫—É'); return; }
      if (bet > balance) { toast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }

      // —Å–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
      balance -= bet; updateBalance();
      betPlaced = bet;

      // –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞—É–Ω–¥
      crashAt = drawCrashMultiplier();
      running = true; crashed = false; cashoutPaid = false;
      elStart.disabled = true; elCash.disabled = false;
      elStatus.textContent = '–í–∑–ª—ë—Ç‚Ä¶ (–∫–æ—ç—Ñ. –∫—Ä–∞—à–∞ —Å–∫—Ä—ã—Ç)';
      t0 = performance.now();
      tick();
    }

    function cashOut(){
      if (!running || crashed || cashoutPaid || betPlaced<=0) return;
      const payout = Math.floor(betPlaced * currentMult);
      balance += payout; updateBalance();
      cashoutPaid = true; running = false;
      cancelAnimationFrame(raf);
      elStatus.textContent = '–ó–∞–±—Ä–∞–Ω–æ!';
      elCash.disabled = true;
      elStart.disabled = false;
      logLine(`–í—ã–≤–æ–¥: <b class="win">+${payout.toLocaleString('ru-RU')}üí∞</b> –ø—Ä–∏ x${currentMult.toFixed(2)} (—Å—Ç–∞–≤–∫–∞ ${betPlaced}üí∞)`);
      toast('–ó–∞–±—Ä–∞–ª! ‚úÖ');
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏
    function tick(){
      const t = (performance.now() - t0) / 1000;
      currentMult = multAt(t);
      // –æ–≥—Ä–∞–Ω–∏—á–∏–º –¥–æ —Å–æ—Ç—ã—Ö
      const shown = Math.max(1.0, Math.floor(currentMult*100)/100);
      elMult.textContent = 'x' + shown.toFixed(2);

      // –¥–≤–∏–∂–µ–Ω–∏–µ —Å–∞–º–æ–ª—ë—Ç–∞ –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏
      const leftPct = 10 + Math.min(80, t*22);   // –≤–ø—Ä–∞–≤–æ
      const bottomPct = 14 + Math.min(72, t*12); // –≤–≤–µ—Ä—Ö
      elPlane.style.left = leftPct + '%';
      elPlane.style.bottom = bottomPct + '%';

      // —Ö–≤–æ—Å—Ç
      const seg = document.createElement('div');
      seg.className = 'trail';
      seg.style.left = `calc(${leftPct}% - 1px)`;
      seg.style.height = Math.max(6, 1+t*12) + 'px';
      seg.style.bottom = `calc(${bottomPct}% - ${Math.max(6, 1+t*12)}px)`;
      elArea.appendChild(seg);
      // —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ
      setTimeout(()=> seg.remove(), 2000);

      // –∞–≤—Ç–æ–∫—ç—à–∞—É—Ç
      const ac = parseFloat(elAutoCash.value);
      if (!isNaN(ac) && ac>=1.01 && !crashed && !cashoutPaid && shown >= ac){
        cashOut();
        return;
      }

      // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—Ä–∞—à
      if (shown >= crashAt && !crashed){
        crashed = true; running = false;
        elPlane.textContent = 'üí•';
        elStatus.textContent = '–ö–†–ê–®!';
        elCash.disabled = true; elStart.disabled = false;
        cancelAnimationFrame(raf);

        // –µ—Å–ª–∏ –Ω–µ —É—Å–ø–µ–ª –∑–∞–±—Ä–∞—Ç—å ‚Äî –ø—Ä–æ–∏–≥—Ä—ã—à —Å—Ç–∞–≤–∫–∏
        if (!cashoutPaid && betPlaced>0){
          logLine(`–ö—Ä–∞—à x${crashAt.toFixed(2)} ‚Äî <b class="lose">-${betPlaced.toLocaleString('ru-RU')}üí∞</b>`);
          toast('–ü—Ä–æ–∏–≥—Ä—ã—à üí•');
        }
        return;
      }

      if (running) raf = requestAnimationFrame(tick);
    }

    // –±–∏–Ω–¥–∏–Ω–≥–∏
    elStart.onclick = startRound;
    elCash.onclick = cashOut;

    // –±—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥ –∞–≤—Ç–æ-–∫—ç—à–∞—É—Ç–∞ –ø–æ —Ç–∞–ø—É –Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
    elMult.addEventListener('click', ()=>{
      elAutoCash.value = (Math.floor(currentMult*100)/100).toFixed(2);
      toast('–ê–≤—Ç–æ-–∫—ç—à–∞—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
    });

    // —Å–±—Ä–æ—Å —Ä–∞—É–Ω–¥–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–ø–æ –∫–ª–∏–∫—É –Ω–∞ –ø–æ–ª–µ)
    document.getElementById('board').addEventListener('click', ()=>{
      if (!running && (crashed || cashoutPaid || betPlaced===0)){
        resetRoundVisual();
      }
    });

    // –Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∏–¥
    resetRoundVisual();
  </script>
</body>
</html>
