<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tap Game</title>
    <style>
      body {
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #00c6ff, #0072ff);
        color: white;
      }
      button {
        background: white;
        color: #0072ff;
        border: none;
        padding: 20px 40px;
        font-size: 22px;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.2s;
      }
      button:hover {
        background: #e0e0e0;
      }
      h1 {
        font-size: 2em;
        margin-bottom: 10px;
      }
      p {
        font-size: 1.2em;
      }
    </style>
  </head>
  <body>
    <h1>üî• Tap Game üî•</h1>

    <p>–°–µ–π—á–∞—Å –≤ Telegram: <b id="online">‚Äî</b></p>

    <p>–û—á–∫–∏: <span id="score">0</span></p>
    <button onclick="tap()">–ñ–ú–ò!</button>

    <script>
      let score = 0;
      function tap() {
        score++;
        document.getElementById('score').innerText = score;
      }

      // Telegram WebApp API ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –æ–∫–Ω–∞
      if (window.Telegram?.WebApp) {
        Telegram.WebApp.expand();
      }

      // === –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Ä–æ—É—Ça /api/tg-count ===
      async function loadTgCount() {
        const el = document.getElementById('online');
        try {
          const res = await fetch('/api/tg-count', { cache: 'no-store' });
          if (!res.ok) throw new Error('Bad response');
          const data = await res.json();
          const n = typeof data.count === 'number' ? data.count : null;
          el.textContent = n != null ? n.toLocaleString('ru-RU') : '‚Äî';
        } catch (e) {
          console.error('tg-count error:', e);
          el.textContent = '‚Äî';
        }
      }

      // –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ä–∞–∑—É –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É)
      loadTgCount();
      setInterval(loadTgCount, 60_000);
    </script>
  </body>
</html>
