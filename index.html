<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tap Game</title>
<p>–°–µ–π—á–∞—Å –æ–Ω–ª–∞–π–Ω: <b id="online">0</b></p>
    <style>
      body {
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #00c6ff, #0072ff);
        color: white;
      }
      button {
        background: white;
        color: #0072ff;
        border: none;
        padding: 20px 40px;
        font-size: 22px;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.2s;
      }
      button:hover {
        background: #e0e0e0;
      }
      h1 {
        font-size: 2em;
        margin-bottom: 10px;
      }
      p {
        font-size: 1.2em;
      }
    </style>
  </head>
  <body>
    <h1>üî• Tap Game üî•</h1>
    <p>–û—á–∫–∏: <span id="score">0</span></p>
    <button onclick="tap()">–ñ–ú–ò!</button>

    <script>
      let score = 0;
      function tap() {
        score++;
        document.getElementById('score').innerText = score;
      }

      // Telegram WebApp API ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –æ–∫–Ω–∞
      if (window.Telegram?.WebApp) {
        Telegram.WebApp.expand();
      }
    </script>
    <!-- Ably Realtime CDN -->
<script src="https://cdn.ably.com/lib/ably.min-1.js"></script>

<script>
  // === –û–Ω–ª–∞–π–Ω-—Å—á—ë—Ç—á–∏–∫ —á–µ—Ä–µ–∑ Ably presence ===
  (function () {
    // 1) –í–°–¢–ê–í–¨ –°–í–û–ô –ö–õ–Æ–ß –ù–ò–ñ–ï
    const ABLY_KEY = 'PASTE_YOUR_ABLY_KEY_HERE';

    // 2) –°–æ–∑–¥–∞—ë–º –∫–ª–∏–µ–Ω—Ç
    const ably = new Ably.Realtime({ key: ABLY_KEY });

    // 3) –ö–∞–Ω–∞–ª —Å presence (–Ω–∞–∑–≤–∞–Ω–∏–µ –ª—é–±–æ–µ, –Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —É –≤—Å–µ—Ö)
    const channel = ably.channels.get('myweb-online');

    // 4) –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    function setOnline(n) {
      const el = document.getElementById('online');
      if (el) el.textContent = n;
    }

    // 5) –ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ‚Äî –≤—Ö–æ–¥–∏–º –≤ presence –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    ably.connection.on('connected', () => {
      // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π id —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ (MVP)
      const me = 'user-' + Math.random().toString(16).slice(2);

      // –í—Ö–æ–¥–∏–º –∫–∞–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π
      channel.presence.enter({ id: me }, (err) => {
        if (err) console.error('presence enter error', err);
      });

      // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —á–∏—Å–ª–æ –æ–Ω–ª–∞–π–Ω
      channel.presence.get((err, members) => {
        if (!err && members) setOnline(members.length);
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ/–≤—ã—Ö–æ–¥–µ
      channel.presence.subscribe(['enter', 'leave', 'update'], () => {
        channel.presence.get((err, members) => {
          if (!err && members) setOnline(members.length);
        });
      });

      // –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –≤—ã—Ö–æ–¥–∏–º –∏–∑ presence
      window.addEventListener('beforeunload', () => {
        try { channel.presence.leave(); } catch(e){}
      });
      window.addEventListener('pagehide', () => {
        try { channel.presence.leave(); } catch(e){}
      });
    });
  })();
</script>

  </body>
</html>

